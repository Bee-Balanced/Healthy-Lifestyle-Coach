<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Home</title>
  <link rel="stylesheet" href="/styles/home.css">
  <script src="https://cdn.plot.ly/plotly-3.0.1.min.js"></script>

  <style>
    /* Navigation Bar Styles */
    .navbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      background-color: #222;
      padding: 15px 20px;
    }
    .navbar .logo {
      font-size: 24px;
      font-weight: bold;
      color: #ffd700; /* Gold color for emphasis */
    }
    .navbar .nav-links {
      display: flex;
      gap: 20px;
    }
    .navbar a {
      color: white;
      text-decoration: none;
      font-size: 18px;
      padding: 10px 15px;
      transition: background 0.3s ease;
    }
    .navbar a:hover {
      background-color: #444;
      border-radius: 5px;
    }

    /* Chart Styling */
    .chart-container {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }
    .chart {
      width: 400px;
      height: 300px;
    }

    select {
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }

    .advice-text {
      background-color: #f9f2d1;
      border-left: 5px solid #ffd700;
      padding: 15px;
      border-radius: 5px;
    }
  </style>
</head>
<body>

  <%- include('partials/navbar') %>

  <div class="home-container">
    <h1>Welcome to Bee Balanced</h1>
    <p>Your daily well-being tracker.</p>

    <div class="home-buttons">
      <a href="/survey" class="btn">Take Today's Survey</a>
      <a href="/logout" class="btn">Logout</a>
    </div>

    <!-- Charts Section -->
    <div class="chart-container">
      <div>
        <h2>Overall Health</h2>
        <div id="overallChart" class="chart"></div>
      </div>

      <div>
        <h2>Mental Health</h2>
        <div id="mentalChart" class="chart"></div>
      </div>

      <div>
        <h2>Physical Health</h2>
        <div id="physicalChart" class="chart"></div>
      </div>

    </div>
    <div class="feedback-section">
      <h2>Personalized Wellness Tips</h2>
      <div class="feedback-grid">
        <% const sections = [
        { title: "Overall Health", feedback: overallFeedback, idPrefix: "overall" },
        { title: "Mental Health", feedback: mentalFeedback, idPrefix: "mental" },
        { title: "Physical Health", feedback: physicalFeedback, idPrefix: "physical" }
      ]; %>
      
      <% sections.forEach(section => { %>
        <div style="margin-top: 30px;">
          <h2><%= section.title %> Feedback</h2>
          <% if (section.feedback && section.feedback.length > 0) { %>
            <select onchange="showAdvice(this.value, '<%= section.idPrefix %>')">
              <option value="">Select an area to improve</option>
              <% section.feedback.forEach((item, index) => { %>
                <option value="<%= section.idPrefix %>Advice<%= index %>"><%= item.question %></option>
              <% }) %>
            </select>
      
            <% section.feedback.forEach((item, index) => { %>
              <div id="<%= section.idPrefix %>Advice<%= index %>" class="advice-text" style="display: none; margin-top: 10px;">
                <p><strong>Why it matters:</strong> <%= item.advice %></p>
              </div>
            <% }) %>
          <% } else { %>
            <p>No feedback available yet. Complete the <%= section.title.toLowerCase() %> survey to receive tips!</p>
          <% } %>
        </div>
      <% }) %>
      
      <script>
        function showAdvice(id, prefix) {
          document.querySelectorAll(`div[id^="${prefix}Advice"]`).forEach(el => el.style.display = 'none');
          if (id) document.getElementById(id).style.display = 'block';
        }
      </script>
      
    
  </div>
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const overallData = <%- JSON.stringify(overallData) %> || [null, null, null, null, null, null, null];
      const mentalData = <%- JSON.stringify(mentalData) %> || [null, null, null, null, null, null, null];
      const physicalData = <%- JSON.stringify(physicalData) %> || [null, null, null, null, null, null, null];
      const days = ['Sunday', 'Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday', 'Saturday'];
  
      function drawChart(chartId, title, data) {
        const validIndices = data
          .map((val, idx) => ({ val, idx }))
          .filter(entry => entry.val !== null);
        
        const lastEntry = validIndices[validIndices.length - 1];
        if (!lastEntry) return;

        const lastX = days[lastEntry.idx];
        const lastY = data[lastEntry.idx];

        Plotly.newPlot(chartId, [{
          x: days,
          y: data,
          type: 'scatter',
          mode: 'lines+markers',
          marker: { color: '#FFFFFF' },
          line: { color: '#FFFFFF' }
        }], {
          title: title,
          titlefont: { color: '#FFD700' },
          xaxis: { title: "Days", tickfont: { color: '#37AE0F' }, linecolor: '#37AE0F' },
          yaxis: { title: "Score", range: [0, 10], tickfont: { color: '#37AE0F' }, linecolor: '#37AE0F' },
          plot_bgcolor: '#cae9f6',
          paper_bgcolor: '#cae9f6',
          images: [{
            source: "/images/bee.gif",
            x: lastX,
            y: lastY,
            xref: "x",
            yref: "y",
            sizex: 3,
            sizey: 3,
            xanchor: "center",
            yanchor: "middle",
            layer: "above"
          }]
        });
      }

      drawChart("overallChart", "Overall Health Progress", overallData);
      drawChart("mentalChart", "Mental Health Progress", mentalData);
      drawChart("physicalChart", "Physical Health Progress", physicalData);
    });
  </script>

</body>
</html>
